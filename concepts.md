# 概念

## 12 factor apps

如今，软件通常会作为一种服务来交付，它们被称为网络应用程序，或软件即服务（SaaS）。12-Factor 为构建如下的 SaaS 应用提供了方法论：

* 使用标准化流程自动配置，从而使新的开发者花费最少的学习成本加入这个项目。
* 和操作系统之间尽可能的划清界限，在各个系统中提供最大的可移植性。
* 适合部署在现代的云计算平台，从而在服务器和系统管理方面节省资源。
* 将开发环境和生产环境的差异降至最低，并使用持续交付实施敏捷开发。
* 可以在工具、架构和开发流程不发生明显变化的前提下实现扩展。

这套理论适用于任意语言和后端服务（数据库、消息队列、缓存等）开发的应用程序。

cde 要求符合 12-factor 规范的应用可以在平台中自由的部署（deploy）和扩容（scale）。

## mesos & marathon

Mesos 对集群中的计算资源进行抽象，使得在使用整个集群时就像是在使用一台计算机一样。它支持大规模集群的水平扩展，可以很好的管理成百上千台的机器。并且 mesos 支持任何的应用（Hadoop，Spark，Web App）部署在其平台上。

Marathon 建立在 mesos 之上，是一个应用部署平台。它支持部署任意形式的服务型应用并支持健康检查，自动重启，应用编排等众多功能。

cde 建立在 marathon 之上，cde 的很多组件都是通过 marathon 管理，并且将所有的应用部署在 marathon 中。

## Docker

Docker 是一个轻量级虚拟化方案，采用 docker 将应用容器化后可以部署到任何支持 docker 的平台（开发环境、测试环境、生产环境）而不用担心环境的兼容性问题，解决了不同环境对部署所带来的问题，大大降低了部署的复杂度。

cde 的组件采用 docker 进行部署，所有运行在 cde 中的应用也都进行了容器化。

## 构建（Build）, 验证（Verify）, 部署（Deploy）

cde 将应用的生命周期定义为一个个的 `build, verify, deploy`。

* `build` 指将代码构建为一个应用，例如采用 java 语言的 web 应用需要将其编译打包成为 `jar` 包。而前端的单页面应用则需要对 `js` `css` 等进行预处理（连接、压缩、uglify 等）。对于不同类型的应用 `build` 的过程可以千变万化，但我们认为凡是将一个代码库转化为一个可执行的应用的过程都是 `build`。
* `verify` 在将应用构建完成之后应用需要进行验收测试保证应用符合预期之后才能够真正的部署上线。这里我们引入了一个验证的过程。在这个过程中要求开发者在完成这次应用提交的功能的同时需要提供一个自动化的验收测试。验证过程执行验收测试并通过之后才能继续后面的部署流程。
* `deploy` 在验证通过之后 cde 将应用打上版本后之后推送到 docker registry 后将其以及其所以来的其他 `backing service` 部署到 `marathon` 平台上。

在开发者修改代码并提交给 cde 之后，cde 按照这个流程将应用最终部署到平台之上，在其中的任意一个环节出了错都会导致应用提交失败。